<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0//EN" "http://www.w3.org/TR/REC-html40/strict.dtd">

<html><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><title>UndoManager</title><link rel="stylesheet" type="text/css" href="../../styles/main.css"><script language=JavaScript src="../../javascript/main.js"></script><script language=JavaScript src="../../javascript/prettify.js"></script><script language=JavaScript src="../../javascript/searchdata.js"></script></head><body class="ContentPage" onLoad="NDOnLoad();prettyPrint();"><script language=JavaScript><!--
if (browserType) {document.write("<div class=" + browserType + ">");if (browserVer) {document.write("<div class=" + browserVer + ">"); }}// --></script>

<!--  Generated by Natural Docs, version 1.52 -->
<!--  http://www.naturaldocs.org  -->

<!-- saved from url=(0026)http://www.naturaldocs.org -->




<div id=Content><div class="CClass"><div class=CTopic id=MainTopic><h1 class=CTitle><a name="UndoManager"></a>UndoManager</h1><div class=CBody><p>Tracks changes to specified Collections (and/or Models) in a somewhat transactional way.</p><p>You don&rsquo;t extend your class with this, nor does it automatically track every model/collection in your app!</p><p>You are meant to use it with discreet user interactions that the user can then undo if they want.</p><h4 class=CHeading>Usage</h4><blockquote><pre class="prettyprint"># Assume elsewhere:
Users= new UserCollection

# Your undoable transaction:
@app.undoMgr.record Users, -&gt;
  user= Users.get id
  user.destroy()

# To undo the changes made:
@app.undoMgr.undo()

# To redo them:
@app.undoMgr.redo()

# -- More complex example --

# Posts and Comments are Collections

newComment: (postId, commentAtts)-&gt;
  @app.undoMgr.record Posts, Comments, -&gt;
    post= Posts.get postId
    commentAtts.postId= postId
    Comments.create commentAtts
    post.set commentCount:(Comments.find {postId}).length
    post.save()

# @app.undoMgr.undo() will now rollback the changes to both collections.</pre></blockquote><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SMain"><td class=SEntry><a href="#UndoManager" >UndoManager</a></td><td class=SDescription>Tracks changes to specified Collections (and/or Models) in a somewhat transactional way.</td></tr><tr class="SGroup SIndent1"><td class=SEntry><a href="#UndoManager.Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#UndoManager.record" >record</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#UndoManager.undo" >undo</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#UndoManager.redo" >redo</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#UndoManager.clear" >clear</a></td><td class=SDescription>NOTE: This will destroy all undo and redo history!</td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#UndoManager.canUndo" >canUndo</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#UndoManager.canRedo" >canRedo</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#UndoManager.dispose" >dispose</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#UndoManager.crudHelpers" >crudHelpers</a></td><td class=SDescription>Static method for creating simple undoable CRUD operations.</td></tr><tr class="SClass"><td class=SEntry><a href="#Transaction" >Transaction</a></td><td class=SDescription>Internal class that encapsulates the tracking of all the model/collection changes that occur within the block of aa <a href="#UndoManager.record" class=LFunction >UndoManager.record</a> call.</td></tr><tr class="SGroup SIndent1"><td class=SEntry><a href="#Transaction.Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#Transaction.label" >label</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#Transaction.execute" >execute</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#Transaction.rollback" >rollback</a></td><td class=SDescription></td></tr><tr class="SClass"><td class=SEntry><a href="#CrudHelpers" >CrudHelpers</a></td><td class=SDescription>Helpers for quickly creating undoable actions for CRUD operations. </td></tr><tr class="SGroup SIndent1"><td class=SEntry><a href="#CrudHelpers.Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#CrudHelpers.doAdd" >doAdd</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2"><td class=SEntry><a href="#CrudHelpers.doRemove" >doRemove</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent2 SMarked"><td class=SEntry><a href="#CrudHelpers.doUpdate" >doUpdate</a></td><td class=SDescription></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="UndoManager.Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.record"></a>record</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>objects...</td><td class=CDLDescription>Collections or Models to track in the undable block</td></tr><tr><td class=CDLEntry>block</td><td class=CDLDescription>Closure around model/collection operations that should be undoable</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.undo"></a>undo</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.redo"></a>redo</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.clear"></a>clear</h3><div class=CBody><p>NOTE: This will destroy all undo and redo history!</p></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.canUndo"></a>canUndo</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.canRedo"></a>canRedo</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.dispose"></a>dispose</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="UndoManager.crudHelpers"></a>crudHelpers</h3><div class=CBody><p>Static method for creating simple undoable CRUD operations.</p><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>collection</td><td class=CDLDescription>A Collection to assign</td></tr></table><h4 class=CHeading>Returns</h4><p><a href="#CrudHelpers" class=LClass id=link1 onMouseOver="ShowTip(event, 'tt1', 'link1')" onMouseOut="HideTip('tt1')">CrudHelpers</a> instance.</p></div></div></div>

<div class="CClass"><div class=CTopic><h2 class=CTitle><a name="Transaction"></a>Transaction</h2><div class=CBody><p>Internal class that encapsulates the tracking of all the model/collection changes that occur within the block of aa <a href="#UndoManager.record" class=LFunction >UndoManager.record</a> call.</p><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SGroup"><td class=SEntry><a href="#Transaction.Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#Transaction.label" >label</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#Transaction.execute" >execute</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#Transaction.rollback" >rollback</a></td><td class=SDescription></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="Transaction.Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="Transaction.label"></a>label</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="Transaction.execute"></a>execute</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="Transaction.rollback"></a>rollback</h3></div></div>

<div class="CClass"><div class=CTopic><h2 class=CTitle><a name="CrudHelpers"></a>CrudHelpers</h2><div class=CBody><p>Helpers for quickly creating undoable actions for CRUD operations.&nbsp; Best used in conjunction with appEvents and your Collection class.</p><h4 class=CHeading>Usage</h4><blockquote><pre class="prettyprint">{Model, Collection, UndoManager}= require 'framework'

class Post extends Model
  @attr 'title', default:'Untitled'

class PostCollection extends Collection
  model: Post

  initialize: -&gt;
    super
    @crud= UndoManager.crudHelpers(this)

  appEvents:
    'update:post', (idOrModel, data)-&gt; @crud.doUpdate idOrModel, data
    'remove:post', (idOrModel)-&gt; @crud.doRemove idOrModel
    'add:post': (data)-&gt;
      @crud.doAdd data, (txn, model)-&gt;
        # You can label this action if you plan on showing a list
        # of history items in your app. Completely optional!
        txn.label &quot;creation of post '#{ model.title() }'&quot;</pre></blockquote><!--START_ND_SUMMARY--><div class=Summary><div class=STitle>Summary</div><div class=SBorder><table border=0 cellspacing=0 cellpadding=0 class=STable><tr class="SGroup"><td class=SEntry><a href="#CrudHelpers.Functions" >Functions</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CrudHelpers.doAdd" >doAdd</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1"><td class=SEntry><a href="#CrudHelpers.doRemove" >doRemove</a></td><td class=SDescription></td></tr><tr class="SFunction SIndent1 SMarked"><td class=SEntry><a href="#CrudHelpers.doUpdate" >doUpdate</a></td><td class=SDescription></td></tr></table></div></div><!--END_ND_SUMMARY--></div></div></div>

<div class="CGroup"><div class=CTopic><h3 class=CTitle><a name="CrudHelpers.Functions"></a>Functions</h3></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CrudHelpers.doAdd"></a>doAdd</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>data</td><td class=CDLDescription>Object of data to update.</td></tr><tr><td class=CDLEntry>callback</td><td class=CDLDescription>Callback function.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CrudHelpers.doRemove"></a>doRemove</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>idOrModel</td><td class=CDLDescription>ID or model instance.</td></tr><tr><td class=CDLEntry>callback</td><td class=CDLDescription>Callback function.</td></tr></table></div></div></div>

<div class="CFunction"><div class=CTopic><h3 class=CTitle><a name="CrudHelpers.doUpdate"></a>doUpdate</h3><div class=CBody><table border=0 cellspacing=0 cellpadding=0 class=CDescriptionList><tr><td class=CDLEntry>idOrModel</td><td class=CDLDescription>ID or model instance.</td></tr><tr><td class=CDLEntry>data</td><td class=CDLDescription>Object of data to update.</td></tr><tr><td class=CDLEntry>callback</td><td class=CDLDescription>Callback function.</td></tr></table></div></div></div>

</div><!--Content-->


<div id=Footer><a href="http://www.naturaldocs.org">Generated by Natural Docs</a></div><!--Footer-->


<div id=Menu><div class=MEntry><div class=MFile><a href="../app-coffee.html">Application</a></div></div><div class=MEntry><div class=MFile><a href="../models/version-coffee.html">Version</a></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent1')">Framework</a><div class=MGroupContent id=MGroupContent1><div class=MEntry><div class=MFile><a href="app-coffee.html">App</a></div></div><div class=MEntry><div class=MFile><a href="collection-coffee.html">Collection</a></div></div><div class=MEntry><div class=MFile><a href="collection-view-coffee.html">CollectionView</a></div></div><div class=MEntry><div class=MFile><a href="controller-coffee.html">Controller</a></div></div><div class=MEntry><div class=MFile><a href="model-coffee.html">Model</a></div></div><div class=MEntry><div class=MFile id=MSelected>UndoManager</div></div><div class=MEntry><div class=MFile><a href="view-coffee.html">View</a></div></div></div></div></div><div class=MEntry><div class=MGroup><a href="javascript:ToggleMenu('MGroupContent2')">Index</a><div class=MGroupContent id=MGroupContent2><div class=MEntry><div class=MIndex><a href="../../index/General.html">Everything</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Classes.html">Classes</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Functions.html">Functions</a></div></div><div class=MEntry><div class=MIndex><a href="../../index/Properties.html">Properties</a></div></div></div></div></div><script type="text/javascript"><!--
var searchPanel = new SearchPanel("searchPanel", "HTML", "../../search");
--></script><div id=MSearchPanel class=MSearchPanelInactive><input type=text id=MSearchField value=Search onFocus="searchPanel.OnSearchFieldFocus(true)" onBlur="searchPanel.OnSearchFieldFocus(false)" onKeyUp="searchPanel.OnSearchFieldChange()"><select id=MSearchType onFocus="searchPanel.OnSearchTypeFocus(true)" onBlur="searchPanel.OnSearchTypeFocus(false)" onChange="searchPanel.OnSearchTypeChange()"><option  id=MSearchEverything selected value="General">Everything</option><option value="Classes">Classes</option><option value="Functions">Functions</option><option value="Properties">Properties</option></select></div></div><!--Menu-->



<!--START_ND_TOOLTIPS-->
<div class=CToolTip id="tt1"><div class=CClass>Helpers for quickly creating undoable actions for CRUD operations. </div></div><!--END_ND_TOOLTIPS-->




<div id=MSearchResultsWindow><iframe src="" frameborder=0 name=MSearchResults id=MSearchResults></iframe><a href="javascript:searchPanel.CloseResultsWindow()" id=MSearchResultsWindowClose>Close</a></div>


<script language=JavaScript><!--
if (browserType) {if (browserVer) {document.write("</div>"); }document.write("</div>");}// --></script></body></html>